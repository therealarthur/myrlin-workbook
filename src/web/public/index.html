<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#1e1e2e">
  <meta name="description" content="myrlin's workbook - Manage Claude Code sessions">
  <title>myrlin's workbook</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400;1,500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="vendor/xterm/xterm.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles-mobile.css">
  <script>
    (function() {
      var t = localStorage.getItem('cwm_theme');
      if (['latte','frappe','macchiato'].includes(t)) document.documentElement.dataset.theme = t;
      var s = parseFloat(localStorage.getItem('cwm_ui_scale'));
      if (s && s >= 0.85 && s <= 1.2) {
        document.documentElement.style.setProperty('--ui-scale', s);
      }
    })();
  </script>
</head>
<body>

  <!-- ═══════════════════════════════════════════ -->
  <!-- LOGIN SCREEN                                -->
  <!-- ═══════════════════════════════════════════ -->
  <div id="login-screen" class="login-screen">
    <div class="login-bg-grid"></div>
    <div class="login-card" role="main">
      <div class="login-brand">
        <div class="login-logo">
          <img src="logo.png" alt="Myrlin" class="login-logo-img">
        </div>
        <h1 class="login-title">myrlin's workbook</h1>
        <p class="login-subtitle">Manage your Claude Code sessions</p>
      </div>

      <form id="login-form" class="login-form" autocomplete="off">
        <div class="input-group">
          <label for="login-password" class="input-label">Password</label>
          <div class="input-wrapper">
            <input
              type="password"
              id="login-password"
              class="input input-has-toggle"
              placeholder="Enter your password"
              autocomplete="current-password"
              required
            >
            <button type="button" class="password-toggle-btn" id="password-toggle-btn" aria-label="Toggle password visibility" tabindex="-1">
              <svg class="pw-icon-show" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 3C4.5 3 1.7 5.1 1 8c.7 2.9 3.5 5 7 5s6.3-2.1 7-5c-.7-2.9-3.5-5-7-5z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="8" cy="8" r="2" stroke="currentColor" stroke-width="1.3"/>
              </svg>
              <svg class="pw-icon-hide" width="16" height="16" viewBox="0 0 16 16" fill="none" style="display:none">
                <path d="M2 2l12 12" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M6.5 6.5a2 2 0 002.83 2.83" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M4.2 4.2C2.8 5.2 1.7 6.5 1 8c.7 2.9 3.5 5 7 5 1.4 0 2.7-.4 3.8-1" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M13.4 10.8C14.3 9.9 15 8.9 15 8c-.7-2.9-3.5-5-7-5-.5 0-1 .1-1.5.2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="input-focus-ring"></div>
          </div>
        </div>
        <div id="login-error" class="login-error" role="alert" aria-live="polite"></div>
        <button type="submit" class="btn btn-primary btn-full" id="login-btn">
          <span class="btn-text">Connect</span>
          <span class="btn-loader" aria-hidden="true"></span>
        </button>
      </form>

      <p class="login-footer">Secured connection to local server</p>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- MAIN APPLICATION                            -->
  <!-- ═══════════════════════════════════════════ -->
  <div id="app" class="app" hidden>

    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M3 4.5h12M3 9h12M3 13.5h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="header-brand">
          <img src="logo.png" alt="myrlin" class="header-logo-img">
          <span class="header-title">myrlin's workbook</span>
        </div>
      </div>

      <div class="header-center">
        <nav class="view-tabs" role="tablist">
          <button class="view-tab" data-mode="workspace" role="tab" aria-selected="false">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <rect x="1" y="1" width="5" height="5" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
              <rect x="8" y="1" width="5" height="5" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
              <rect x="1" y="8" width="5" height="5" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
              <rect x="8" y="8" width="5" height="5" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
            </svg>
            Workspace
          </button>
          <button class="view-tab" data-mode="all" role="tab" aria-selected="false">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M2 4h10M2 7h10M2 10h10" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            All
          </button>
          <button class="view-tab" data-mode="recent" role="tab" aria-selected="false">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <circle cx="7" cy="7" r="5.5" stroke="currentColor" stroke-width="1.2"/>
              <path d="M7 4v3.5l2.5 1.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Recent
          </button>
          <button class="view-tab active" data-mode="terminal" role="tab" aria-selected="true">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm3.5 1a.5.5 0 0 0-.354.854l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5A.5.5 0 0 0 8.5 3h-5z"/></svg>
            Terminal
          </button>
          <button class="view-tab" data-mode="docs" role="tab" aria-selected="false">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
              <path d="M4 1h8a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V2a1 1 0 011-1z" stroke="currentColor" stroke-width="1.2"/>
              <path d="M6 5h4M6 8h4M6 11h2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            Docs
          </button>
          <button class="view-tab" data-mode="resources" role="tab" aria-selected="false">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
              <path d="M2 12V8h3v4H2zM6.5 12V5h3v7h-3zM11 12V2h3v10h-3z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round"/>
            </svg>
            Resources
          </button>
        </nav>
      </div>

      <div class="header-right">
        <button class="btn btn-ghost btn-icon update-btn" id="update-btn" title="Check for updates" hidden>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 1v6m0 0l2.5-2.5M8 7L5.5 4.5M2 10l.8 2.4c.2.6.8 1.1 1.5 1.1h7.4c.7 0 1.3-.4 1.5-1.1L14 10" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="update-badge" id="update-badge" hidden></span>
        </button>
        <div class="theme-picker" id="theme-picker">
          <button class="btn btn-ghost btn-icon" id="theme-toggle-btn" title="Change theme">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.3"/>
              <path d="M8 2a6 6 0 000 12V2z" fill="currentColor" opacity="0.3"/>
            </svg>
          </button>
          <div class="theme-dropdown" id="theme-dropdown" hidden>
            <button class="theme-option" data-theme="mocha"><span class="theme-swatch" style="background:#1e1e2e"></span>Mocha</button>
            <button class="theme-option" data-theme="macchiato"><span class="theme-swatch" style="background:#24273a"></span>Macchiato</button>
            <button class="theme-option" data-theme="frappe"><span class="theme-swatch" style="background:#303446"></span>Frapp&eacute;</button>
            <button class="theme-option" data-theme="latte"><span class="theme-swatch" style="background:#eff1f5;border:1px solid #ccd0da"></span>Latte</button>
          </div>
        </div>
        <div class="scale-controls" id="scale-controls">
          <button class="btn btn-ghost btn-icon btn-sm scale-btn" id="scale-down-btn" title="Decrease UI size">
            <span class="scale-btn-label">A<sup>-</sup></span>
          </button>
          <button class="btn btn-ghost btn-icon btn-sm scale-btn" id="scale-up-btn" title="Increase UI size">
            <span class="scale-btn-label">A<sup>+</sup></span>
          </button>
        </div>
        <div class="header-stats" id="header-stats">
          <div class="stat-chip" title="Running sessions">
            <span class="stat-dot stat-dot-running"></span>
            <span id="stat-running">0</span>
          </div>
          <div class="stat-chip" title="Total sessions">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M3 2h8a1 1 0 011 1v8a1 1 0 01-1 1H3a1 1 0 01-1-1V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.2"/>
            </svg>
            <span id="stat-total">0</span>
          </div>
        </div>

        <button class="btn btn-ghost btn-icon header-search-btn" id="open-switcher-btn" title="Quick Switcher (Ctrl+K)">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.3"/>
            <path d="M10 10l3.5 3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
          </svg>
        </button>

        <button class="btn btn-ghost btn-icon" id="restart-all-btn" title="Restart all running sessions">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M2 8a6 6 0 0110.5-4M14 2v4h-4M14 8a6 6 0 01-10.5 4M2 14v-4h4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button class="btn btn-ghost btn-icon" id="logout-btn" title="Logout">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M6 2H4a2 2 0 00-2 2v8a2 2 0 002 2h2M10.5 11.5L14 8l-3.5-3.5M14 8H6" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Layout -->
    <div class="app-body">

      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2 class="sidebar-title">Workspaces</h2>
          <button class="btn btn-ghost btn-icon btn-sm" id="create-workspace-btn" title="New workspace">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M7 2v10M2 7h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <div class="sidebar-list" id="workspace-list">
          <!-- Workspace items rendered here -->
        </div>
        <div class="sidebar-footer">
          <div class="sidebar-meta" id="sidebar-meta">
            <span id="workspace-count">0 workspaces</span>
            <button class="btn btn-ghost btn-sm toggle-hidden-btn" id="toggle-hidden-btn" title="Toggle hidden sessions">
              <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M8 3C4.5 3 1.7 5.1 1 8c.7 2.9 3.5 5 7 5s6.3-2.1 7-5c-.7-2.9-3.5-5-7-5zm0 8a3 3 0 110-6 3 3 0 010 6zm0-5a2 2 0 100 4 2 2 0 000-4z"/></svg>
              <span id="toggle-hidden-label">Show hidden</span>
            </button>
          </div>
        </div>
        <div class="sidebar-section-resize" id="sidebar-section-resize"></div>
        <div class="sidebar-header" id="projects-header">
          <h2 class="sidebar-title">Projects</h2>
          <button class="btn btn-ghost btn-icon btn-sm" id="projects-refresh" title="Refresh projects">
            <svg width="12" height="12" viewBox="0 0 14 14" fill="none">
              <path d="M2 7a5 5 0 019.33-2.5M12 7a5 5 0 01-9.33 2.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              <path d="M11 2v3h-3M3 12V9h3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="btn btn-ghost btn-icon btn-sm" id="projects-toggle" title="Toggle projects">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 6l3.5 4 3.5-4z"/></svg>
          </button>
        </div>
        <div class="projects-search-bar" id="projects-search-bar">
          <input type="text" id="projects-search-input" class="projects-search-input" placeholder="Filter projects or session IDs..." spellcheck="false" autocomplete="off" />
          <button class="btn btn-ghost btn-sm find-conversation-btn" id="find-conversation-btn" title="Search inside conversation content">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
              <circle cx="6.5" cy="6.5" r="5" stroke="currentColor" stroke-width="1.5"/>
              <path d="M10.5 10.5L14.5 14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Find a Conversation
          </button>
        </div>
        <div class="sidebar-list" id="projects-list">
          <!-- Discovered projects rendered by app.js -->
        </div>
        <!-- Sidebar Collapse Button (desktop) -->
        <div class="sidebar-collapse-bar">
          <button class="sidebar-collapse-btn" id="sidebar-collapse-btn" title="Collapse sidebar">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
              <path d="M10 3L5 8l5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </aside>

      <!-- Sidebar Resize Handle -->
      <div class="sidebar-resize-handle" id="sidebar-resize-handle"></div>

      <!-- Content -->
      <main class="main-content" id="main-content">

        <!-- Session List -->
        <div class="session-list-panel" id="session-list-panel">
          <div class="panel-header">
            <h2 class="panel-title" id="session-panel-title">Sessions</h2>
            <div style="display: flex; gap: 6px;">
              <button class="btn btn-ghost btn-sm" id="discover-btn" title="Discover Claude sessions on this PC">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <circle cx="6" cy="6" r="4.5" stroke="currentColor" stroke-width="1.3"/>
                  <path d="M9.5 9.5L13 13" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                </svg>
                Discover
              </button>
              <button class="btn btn-primary btn-sm" id="create-session-btn">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path d="M7 2v10M2 7h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                New
              </button>
            </div>
          </div>
          <div class="session-list" id="session-list">
            <!-- Session items rendered here -->
          </div>
          <div class="empty-state" id="session-empty" hidden>
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
              <rect x="8" y="8" width="32" height="32" rx="8" stroke="var(--surface2)" stroke-width="2"/>
              <path d="M18 20h12M18 26h8" stroke="var(--surface2)" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <p class="empty-title">No sessions yet</p>
            <p class="empty-desc">Create a session to get started</p>
          </div>
        </div>

        <!-- Session Detail -->
        <div class="session-detail-panel" id="session-detail-panel" hidden>
          <div class="detail-header">
            <button class="btn btn-ghost btn-icon btn-sm detail-back-btn" id="detail-back-btn" title="Back to list">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M10 3L5 8l5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="detail-title-row">
              <span class="detail-status-dot" id="detail-status-dot"></span>
              <h2 class="detail-title" id="detail-title">Session Name</h2>
            </div>
            <div class="detail-actions">
              <button class="btn btn-ghost btn-icon btn-sm" id="detail-rename-btn" title="Rename session">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path d="M8.5 2.5l3 3M2 9.5V12h2.5L11 5.5l-3-3L2 9.5z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="btn btn-ghost btn-icon btn-sm" id="detail-delete-btn" title="Hide session">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path d="M2.5 4h9M5 4V2.5h4V4M3.5 4v7.5a1 1 0 001 1h5a1 1 0 001-1V4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="detail-body" id="detail-body">
            <div class="detail-meta">
              <div class="meta-row">
                <span class="meta-label">Status</span>
                <span class="meta-value" id="detail-status-badge"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Workspace</span>
                <span class="meta-value" id="detail-workspace"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Directory</span>
                <span class="meta-value meta-mono" id="detail-dir"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Topic</span>
                <span class="meta-value" id="detail-topic"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Command</span>
                <span class="meta-value meta-mono" id="detail-command"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">PID</span>
                <span class="meta-value meta-mono" id="detail-pid"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Ports</span>
                <span class="meta-value meta-mono" id="detail-ports"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Branch</span>
                <span class="meta-value meta-mono" id="detail-branch"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Created</span>
                <span class="meta-value" id="detail-created"></span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Last Active</span>
                <span class="meta-value" id="detail-last-active"></span>
              </div>
            </div>

            <!-- Cost tracking -->
            <div class="cost-summary" id="detail-cost" hidden>
              <div class="cost-total-label">Estimated Cost</div>
              <div class="cost-total" id="detail-cost-total">$0.00</div>
              <div class="cost-breakdown" id="detail-cost-breakdown"></div>
              <div class="token-bar" id="detail-token-bar">
                <div class="token-bar-fill token-bar-input" id="detail-token-input" style="width:0"></div>
              </div>
              <div style="display:flex;gap:12px;font-size:10px;color:var(--subtext0);margin-top:2px">
                <span><span style="color:var(--blue)">&#9679;</span> Input</span>
                <span><span style="color:var(--peach)">&#9679;</span> Output</span>
                <span><span style="color:var(--green)">&#9679;</span> Cache</span>
              </div>
            </div>

            <!-- Subagent Tracking -->
            <div class="subagent-section" id="detail-subagents" hidden>
              <div class="subagent-header">
                <span class="subagent-label">Subagents</span>
                <span class="subagent-count" id="detail-subagent-count">0</span>
              </div>
              <div class="subagent-list" id="detail-subagent-list"></div>
            </div>

            <!-- Workspace Analytics -->
            <div class="detail-analytics" id="detail-analytics" hidden>
              <div class="detail-section-title">Analytics</div>
              <div class="analytics-grid" id="analytics-grid"></div>
              <div class="analytics-top-sessions" id="analytics-top-sessions"></div>
            </div>

            <div class="detail-control-bar">
              <button class="btn btn-primary btn-sm" id="detail-start-btn">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path d="M4 2.5l8 4.5-8 4.5V2.5z" fill="currentColor"/>
                </svg>
                Start
              </button>
              <button class="btn btn-ghost btn-sm" id="detail-stop-btn">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <rect x="3" y="3" width="8" height="8" rx="1.5" fill="currentColor"/>
                </svg>
                Stop
              </button>
              <button class="btn btn-ghost btn-sm" id="detail-restart-btn">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path d="M2 7a5 5 0 019.33-2.5M12 7a5 5 0 01-9.33 2.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                  <path d="M11 2v3h-3M3 12V9h3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Restart
              </button>
            </div>

            <div class="detail-logs">
              <h3 class="detail-logs-title">Activity Log</h3>
              <div class="logs-container" id="detail-logs">
                <!-- Log entries rendered here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Terminal Tab Groups Bar -->
        <div class="terminal-groups-bar" id="terminal-groups-bar" hidden>
          <div class="terminal-groups-tabs" id="terminal-groups-tabs">
            <!-- Tab group tabs rendered by app.js -->
          </div>
          <button class="btn btn-ghost btn-icon btn-sm terminal-groups-add" id="terminal-groups-add" title="New tab group">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M7 2v10M2 7h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        <!-- Terminal Grid (starts with 1 pane, auto-expands on drop) -->
        <div class="terminal-grid" id="terminal-grid" data-panes="1" hidden>
          <div class="terminal-tab-strip" id="terminal-tab-strip" hidden></div>
          <div class="terminal-pane terminal-pane-empty" id="term-pane-0" data-slot="0">
            <div class="terminal-pane-header">
              <span class="terminal-pane-title">Drop a session here</span>
              <span class="terminal-pane-activity" id="term-activity-0"></span>
              <button class="terminal-pane-close btn btn-ghost btn-icon btn-sm" hidden>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
              </button>
            </div>
            <div class="terminal-container" id="term-container-0"></div>
            <div class="terminal-mobile-toolbar">
              <button class="toolbar-keyboard" data-key="keyboard" title="Toggle keyboard">&#9000; Type</button>
              <button class="toolbar-send" data-key="enter">Enter</button>
              <button data-key="tab">Tab</button>
              <button data-key="ctrlc">Ctrl+C</button>
              <button data-key="ctrld">Ctrl+D</button>
              <button data-key="escape">Esc</button>
              <button data-key="up">&#8593;</button>
              <button data-key="down">&#8595;</button>
            </div>
          </div>
          <div class="terminal-pane terminal-pane-empty" id="term-pane-1" data-slot="1" hidden>
            <div class="terminal-pane-header">
              <span class="terminal-pane-title">Drop a session here</span>
              <span class="terminal-pane-activity" id="term-activity-1"></span>
              <button class="terminal-pane-close btn btn-ghost btn-icon btn-sm" hidden>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
              </button>
            </div>
            <div class="terminal-container" id="term-container-1"></div>
            <div class="terminal-mobile-toolbar">
              <button class="toolbar-keyboard" data-key="keyboard" title="Toggle keyboard">&#9000; Type</button>
              <button class="toolbar-send" data-key="enter">Enter</button>
              <button data-key="tab">Tab</button>
              <button data-key="ctrlc">Ctrl+C</button>
              <button data-key="ctrld">Ctrl+D</button>
              <button data-key="escape">Esc</button>
              <button data-key="up">&#8593;</button>
              <button data-key="down">&#8595;</button>
            </div>
          </div>
          <div class="terminal-pane terminal-pane-empty" id="term-pane-2" data-slot="2" hidden>
            <div class="terminal-pane-header">
              <span class="terminal-pane-title">Drop a session here</span>
              <span class="terminal-pane-activity" id="term-activity-2"></span>
              <button class="terminal-pane-close btn btn-ghost btn-icon btn-sm" hidden>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
              </button>
            </div>
            <div class="terminal-container" id="term-container-2"></div>
            <div class="terminal-mobile-toolbar">
              <button class="toolbar-keyboard" data-key="keyboard" title="Toggle keyboard">&#9000; Type</button>
              <button class="toolbar-send" data-key="enter">Enter</button>
              <button data-key="tab">Tab</button>
              <button data-key="ctrlc">Ctrl+C</button>
              <button data-key="ctrld">Ctrl+D</button>
              <button data-key="escape">Esc</button>
              <button data-key="up">&#8593;</button>
              <button data-key="down">&#8595;</button>
            </div>
          </div>
          <div class="terminal-pane terminal-pane-empty" id="term-pane-3" data-slot="3" hidden>
            <div class="terminal-pane-header">
              <span class="terminal-pane-title">Drop a session here</span>
              <span class="terminal-pane-activity" id="term-activity-3"></span>
              <button class="terminal-pane-close btn btn-ghost btn-icon btn-sm" hidden>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
              </button>
            </div>
            <div class="terminal-container" id="term-container-3"></div>
            <div class="terminal-mobile-toolbar">
              <button class="toolbar-keyboard" data-key="keyboard" title="Toggle keyboard">&#9000; Type</button>
              <button class="toolbar-send" data-key="enter">Enter</button>
              <button data-key="tab">Tab</button>
              <button data-key="ctrlc">Ctrl+C</button>
              <button data-key="ctrld">Ctrl+D</button>
              <button data-key="escape">Esc</button>
              <button data-key="up">&#8593;</button>
              <button data-key="down">&#8595;</button>
            </div>
          </div>
        </div>

        <!-- Workspace Documentation Panel -->
        <div class="docs-panel" id="docs-panel" hidden>
          <div class="docs-header">
            <div class="docs-header-left">
              <h2 class="docs-title">Documentation</h2>
              <span class="docs-workspace-name" id="docs-workspace-name"></span>
            </div>
            <div class="docs-header-right">
              <button class="btn btn-ghost btn-sm" id="docs-toggle-raw" title="Toggle raw markdown editor">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M2 4l3 4-3 4M8 12h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Raw
              </button>
              <button class="btn btn-primary btn-sm" id="docs-save-btn" hidden>Save</button>
            </div>
          </div>

          <!-- Docs / Board Tab Bar -->
          <div class="docs-tabs">
            <button class="docs-tab active" data-tab="docs">Docs</button>
            <button class="docs-tab" data-tab="board">Board</button>
          </div>

          <!-- Feature Board (Kanban) -->
          <div class="feature-board" id="feature-board" hidden>
            <div class="board-toolbar">
              <button class="btn btn-sm btn-ghost" id="board-add-btn">+ Feature</button>
            </div>
            <div class="board-columns" id="board-columns">
              <div class="board-column" data-status="planned">
                <div class="board-column-header">
                  <span class="board-column-title">Planned</span>
                  <span class="board-column-count" data-count="planned">0</span>
                </div>
                <div class="board-column-body" data-status="planned"></div>
              </div>
              <div class="board-column" data-status="active">
                <div class="board-column-header">
                  <span class="board-column-title">Active</span>
                  <span class="board-column-count" data-count="active">0</span>
                </div>
                <div class="board-column-body" data-status="active"></div>
              </div>
              <div class="board-column" data-status="review">
                <div class="board-column-header">
                  <span class="board-column-title">Review</span>
                  <span class="board-column-count" data-count="review">0</span>
                </div>
                <div class="board-column-body" data-status="review"></div>
              </div>
              <div class="board-column" data-status="done">
                <div class="board-column-header">
                  <span class="board-column-title">Done</span>
                  <span class="board-column-count" data-count="done">0</span>
                </div>
                <div class="board-column-body" data-status="done"></div>
              </div>
            </div>
          </div>

          <!-- Structured View -->
          <div class="docs-structured" id="docs-structured">
            <div class="docs-section" data-section="notes">
              <div class="docs-section-header">
                <span class="docs-section-chevron open">&#9654;</span>
                <h3 class="docs-section-title">Notes</h3>
                <span class="docs-section-count" id="docs-notes-count">0</span>
                <button class="btn btn-ghost btn-icon btn-sm docs-add-btn" data-section="notes" title="Add note">+</button>
              </div>
              <div class="docs-section-body" id="docs-notes-list"></div>
            </div>

            <div class="docs-section" data-section="goals">
              <div class="docs-section-header">
                <span class="docs-section-chevron open">&#9654;</span>
                <h3 class="docs-section-title">Goals</h3>
                <span class="docs-section-count" id="docs-goals-count">0</span>
                <button class="btn btn-ghost btn-icon btn-sm docs-add-btn" data-section="goals" title="Add goal">+</button>
              </div>
              <div class="docs-section-body" id="docs-goals-list"></div>
            </div>

            <div class="docs-section" data-section="tasks">
              <div class="docs-section-header">
                <span class="docs-section-chevron open">&#9654;</span>
                <h3 class="docs-section-title">Tasks</h3>
                <span class="docs-section-count" id="docs-tasks-count">0</span>
                <button class="btn btn-ghost btn-icon btn-sm docs-add-btn" data-section="tasks" title="Add task">+</button>
              </div>
              <div class="docs-section-body" id="docs-tasks-list"></div>
            </div>

            <div class="docs-section" data-section="roadmap">
              <div class="docs-section-header">
                <span class="docs-section-chevron open">&#9654;</span>
                <h3 class="docs-section-title">Roadmap</h3>
                <span class="docs-section-count" id="docs-roadmap-count">0</span>
                <button class="btn btn-ghost btn-icon btn-sm docs-add-btn" data-section="roadmap" title="Add milestone">+</button>
              </div>
              <div class="docs-section-body" id="docs-roadmap-list"></div>
            </div>

            <div class="docs-section" data-section="rules">
              <div class="docs-section-header">
                <span class="docs-section-chevron open">&#9654;</span>
                <h3 class="docs-section-title">Rules</h3>
                <span class="docs-section-count" id="docs-rules-count">0</span>
                <button class="btn btn-ghost btn-icon btn-sm docs-add-btn" data-section="rules" title="Add rule">+</button>
              </div>
              <div class="docs-section-body" id="docs-rules-list"></div>
            </div>

            <div class="docs-section docs-ai-section" data-section="ai-insights">
              <div class="docs-section-header">
                <span class="docs-section-chevron open">&#9654;</span>
                <h3 class="docs-section-title">AI Insights</h3>
                <button class="btn btn-ghost btn-sm" id="docs-ai-refresh" title="Refresh summaries">
                  <svg width="12" height="12" viewBox="0 0 14 14" fill="none">
                    <path d="M2 7a5 5 0 019.33-2.5M12 7a5 5 0 01-9.33 2.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                    <path d="M11 2v3h-3M3 12V9h3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Refresh
                </button>
              </div>
              <div class="docs-section-body docs-ai-body" id="docs-ai-insights">
                <div class="ai-insights-empty">Select a workspace to see AI-generated session summaries</div>
              </div>
            </div>
          </div>

          <!-- Raw Editor View -->
          <div class="docs-raw" id="docs-raw" hidden>
            <textarea class="docs-raw-editor" id="docs-raw-editor" placeholder="# Workspace Documentation&#10;&#10;## Notes&#10;&#10;## Goals&#10;&#10;## Tasks" spellcheck="false"></textarea>
          </div>
        </div>

        <!-- Resources Panel -->
        <div class="resources-panel" id="resources-panel" hidden>
          <div class="resources-header">
            <h2 class="resources-title">System Resources</h2>
            <div class="resources-header-actions">
              <span class="resources-refresh-indicator" id="resources-refresh-indicator">Auto-refresh: 10s</span>
              <button class="btn btn-ghost btn-sm resources-refresh-btn" id="resources-refresh-btn" title="Refresh now">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M14 2v4h-4M2 14v-4h4M2.5 6.5A6 6 0 0114 4M13.5 9.5A6 6 0 012 12" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </div>
          <div class="resources-body" id="resources-body">
            <!-- Resource cards and session table rendered by app.js -->
            <div class="resources-loading">Loading resource data...</div>
          </div>
        </div>

      </main>
    </div>

    <!-- ═══════════════════════════════════════════ -->
    <!-- NOTES EDITOR MODAL                          -->
    <!-- ═══════════════════════════════════════════ -->
    <div class="modal-overlay" id="notes-editor-overlay" hidden>
      <div class="notes-editor-modal" role="dialog" aria-label="Notes Editor">
        <div class="notes-editor-header">
          <h3 class="notes-editor-title" id="notes-editor-title">Edit Note</h3>
          <div class="notes-editor-toolbar">
            <button class="btn btn-ghost btn-sm notes-toolbar-btn" data-action="bold" title="Bold"><strong>B</strong></button>
            <button class="btn btn-ghost btn-sm notes-toolbar-btn" data-action="italic" title="Italic"><em>I</em></button>
            <button class="btn btn-ghost btn-sm notes-toolbar-btn" data-action="code" title="Code">&lt;/&gt;</button>
            <button class="btn btn-ghost btn-sm notes-toolbar-btn" data-action="link" title="Link">Link</button>
            <button class="btn btn-ghost btn-sm notes-toolbar-btn" data-action="list" title="List">List</button>
          </div>
          <button class="btn btn-ghost btn-icon btn-sm" id="notes-editor-close" aria-label="Close">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M3 3l8 8M11 3l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <textarea class="notes-editor-textarea" id="notes-editor-textarea" placeholder="Write your note here... Markdown is supported." spellcheck="true"></textarea>
        <div class="notes-editor-footer">
          <span class="notes-editor-hint">Markdown supported. Ctrl+Enter to save.</span>
          <div class="notes-editor-actions">
            <button class="btn btn-ghost" id="notes-editor-cancel">Cancel</button>
            <button class="btn btn-primary" id="notes-editor-save">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ═══════════════════════════════════════════ -->
    <!-- MOBILE BOTTOM TAB BAR                       -->
    <!-- ═══════════════════════════════════════════ -->
    <nav class="mobile-tab-bar" id="mobile-tab-bar" hidden>
      <button class="mobile-tab" data-view="workspace" aria-label="Workspaces">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <rect x="2" y="3" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.4"/>
          <rect x="11" y="3" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.4"/>
          <rect x="2" y="12" width="7" height="5" rx="1.5" stroke="currentColor" stroke-width="1.4"/>
          <rect x="11" y="12" width="7" height="5" rx="1.5" stroke="currentColor" stroke-width="1.4"/>
        </svg>
        <span>Spaces</span>
      </button>
      <button class="mobile-tab" data-view="all" aria-label="All Sessions">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M3 5h14M3 10h14M3 15h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
        </svg>
        <span>Sessions</span>
      </button>
      <button class="mobile-tab" data-view="terminal" aria-label="Terminal">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <rect x="2" y="3" width="16" height="14" rx="2" stroke="currentColor" stroke-width="1.4"/>
          <path d="M5 8l3 2.5L5 13" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M11 13h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
        </svg>
        <span>Terminal</span>
      </button>
      <button class="mobile-tab" data-view="docs" aria-label="Docs">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M5 2h7l4 4v12a1 1 0 01-1 1H5a1 1 0 01-1-1V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4"/>
          <path d="M12 2v4h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
          <path d="M7 10h6M7 13h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
        </svg>
        <span>Docs</span>
      </button>
      <button class="mobile-tab" data-view="more" id="mobile-more-tab" aria-label="More">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <circle cx="10" cy="5" r="1.5" fill="currentColor"/>
          <circle cx="10" cy="10" r="1.5" fill="currentColor"/>
          <circle cx="10" cy="15" r="1.5" fill="currentColor"/>
        </svg>
        <span>More</span>
      </button>
    </nav>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- QUICK SWITCHER MODAL                        -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="modal-overlay" id="quick-switcher-overlay" hidden>
    <div class="quick-switcher" role="dialog" aria-label="Quick Switcher">
      <div class="qs-input-row">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="qs-icon">
          <circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.3"/>
          <path d="M10 10l3.5 3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
        </svg>
        <input
          type="text"
          id="qs-input"
          class="qs-search-input"
          placeholder="Search workspaces and sessions..."
          autocomplete="off"
        >
        <kbd class="qs-shortcut">Esc</kbd>
      </div>
      <div class="qs-results" id="qs-results">
        <!-- Search results rendered here -->
      </div>
      <div class="qs-footer">
        <span class="qs-hint"><kbd>&uarr;</kbd><kbd>&darr;</kbd> navigate</span>
        <span class="qs-hint"><kbd>Enter</kbd> select</span>
        <span class="qs-hint"><kbd>Esc</kbd> close</span>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- GLOBAL SEARCH OVERLAY (Ctrl+Shift+F)        -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="qs-overlay" id="search-overlay" hidden>
    <div class="qs-panel" id="search-panel">
      <input class="qs-input" id="search-input" type="text" placeholder="Search all sessions..." autocomplete="off">
      <div class="qs-results" id="search-results"></div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- FIND CONVERSATION MODAL                     -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="modal-overlay" id="find-convo-overlay" hidden>
    <div class="modal find-convo-modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3 class="modal-title">Find a Conversation</h3>
        <button class="btn btn-ghost btn-icon btn-sm" id="find-convo-close" aria-label="Close">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M3 3l8 8M11 3l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="modal-body find-convo-body">
        <input type="text" id="find-convo-input" class="find-convo-input" placeholder="Describe the conversation you're looking for..." spellcheck="false" autocomplete="off" />
        <div class="find-convo-hint">Search across all session content. Try topics, file names, or keywords.</div>
        <div class="find-convo-results" id="find-convo-results"></div>
      </div>
    </div>
  </div>

  <!-- GENERIC MODAL (Confirm / Prompt)            -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="modal-overlay" id="modal-overlay" hidden>
    <div class="modal" id="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Modal Title</h3>
        <button class="btn btn-ghost btn-icon btn-sm modal-close-btn" id="modal-close-btn" aria-label="Close">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M3 3l8 8M11 3l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Modal content rendered dynamically -->
      </div>
      <div class="modal-footer" id="modal-footer">
        <button class="btn btn-ghost" id="modal-cancel-btn">Cancel</button>
        <button class="btn btn-primary" id="modal-confirm-btn">Confirm</button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- UPDATE MODAL                                -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="modal-overlay" id="update-overlay" hidden>
    <div class="modal update-modal">
      <div class="modal-header">
        <h3 class="modal-title">Update Myrlin</h3>
        <button class="modal-close btn btn-ghost btn-icon btn-sm" id="update-close-btn">&times;</button>
      </div>
      <div class="modal-body" id="update-body">
        <div class="update-status" id="update-status"></div>
        <div class="update-steps" id="update-steps"></div>
      </div>
      <div class="modal-footer" id="update-footer">
        <button class="btn btn-primary" id="update-start-btn">Update Now</button>
        <button class="btn btn-ghost" id="update-dismiss-btn">Later</button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- TOAST NOTIFICATION AREA                     -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="toast-container" id="toast-container" aria-live="polite"></div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- CONTEXT MENU                                -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="context-menu" id="context-menu" hidden>
    <div class="context-menu-items" id="context-menu-items"></div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- ACTION SHEET (Mobile context menu)          -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="action-sheet-overlay" id="action-sheet-overlay" hidden>
    <div class="action-sheet" id="action-sheet">
      <div class="action-sheet-handle"></div>
      <div class="action-sheet-header" id="action-sheet-header"></div>
      <div class="action-sheet-items" id="action-sheet-items"></div>
      <button class="action-sheet-cancel" id="action-sheet-cancel">Cancel</button>
    </div>
  </div>

  <script src="vendor/xterm/xterm.min.js"></script>
  <script src="vendor/xterm-addon-fit/xterm-addon-fit.min.js"></script>
  <script src="vendor/xterm-addon-web-links/xterm-addon-web-links.min.js"></script>
  <script src="terminal.js"></script>
  <script src="app.js"></script>
</body>
</html>
